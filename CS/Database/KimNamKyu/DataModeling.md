# 데이터 모델링의 이해

- 주요 내용
  - 데이터 모델링의 3단계: 개념적, 논리적, 물리적 모델링
  - 데이터 독립성
  - 데이터 모델의 구성요소
    - 엔터티, 관계/차수, 속성/식별자
  - 다양한 ERD 표기법
    - Peter Chen(실무에서는 거의 사용 안함), IE, Barker 표기법 위주로 사용

## 데이터 모델링 개요

![img1](images/data_modeling1.png)

- 모델링이란?
  - 복잡한 현실 세계를 추상화, 단순화하여 일정한 표기법에 의해 명확하게 표현하는 것
  - 추상화, 단순화, 명확화(구체화,복잡화,일반화가 아님)
- 즉, 데이터 모델링이란 현실세계 ─(추상화, 단순화 , 명확화)──►모델 로 바꾸는것
  - 모델: 현실 세계의 추상화된 반영
- 모델링의 관점
  - 데이터 관점(What): 데이터와 데이터 간의 관계, 업무와 데이터 간 관계를 모델링(How/프로세스, Who/누구 와는 상관이 없다)
  - 프로세스 관점(How): 업무가 실제로 하고있는 일 또는 해야할 일을 모델링

## 데이터 모델링의 3단계

![img2](images/data_modeling2.png)

- 산업계(실무)
  - 개요: 개념적/논리적 모델링을 동시에 수행, 물리적 모델링에서 테이블 도출
  - 개념적 모델링
    - 핵심 엔터티/관계/속성 중심 ERD 도출
    - 추상화 수준이 높고 업무 중심적인 포괄적 모델링
    - 관계가 자체 속성을 가질 수 없음
    - IE/Crow's Foot 타입의 ERD 사용
  - 논리적 모델링
    - 훨씬 구체적인 수준의 ERD 도출
    - 시스템으로 구축하고자 하는 업무에 대한 식별자, 속성, 관계 등을 명시
    - M:N 관계 해서(여러개의 1:N으로 분해)
  - 테이블 도출(기본키, 외래키, 컬럼 정의)
    - 정규화 및 반정규화 수행
    - 데이터 타입 정의, 인덱스 설계, 뷰 설계

## 데이터 베이스의 장점

### 데이터 독립성

![img3](images/data_modeling3.png)

- 파일 시스템의 경우 고객의 연락처와 주소가 바뀐다면, 주문 관리 응용프로그램의 중복값과 값의 불일치가 발생한다
- 데이터 구조가 변경되어도 응용프로그램이 변경될 필요가 없는 것
  - 논리적 독립성 + 물리적 독립성으로 실현됨
- 데이터 독립성이 유지되지 않는다면?
  - 데이터의 중복성 및 복잡도 증가(파일 시스템으로 db를 구현하면 해당 문제가 생긴다)
  - 요구사항 대응 난이도 증가 -> 데이터 유지보수 비용 증가
- 논리적 독립성/물리적 독립성
  - 물리적 독립성
    - 정의: 물리적 저장 구조(저장 위치, 인덱스 구조 등)의 변경이 있어도 논리적 스키마나 응용 프로그램에 영향을 주지 않는 성질이다.
    - 예시: 데이터를 더 빠르게 조회하기 위해 인덱스를 추가하거나, 파일 구조를 바꾼 경우에도 SQL 쿼리나 프로그램 로직은 그대로 동작해야 한다.
  - 논리적 독립성
    - 정의: 논리적 스키마(=개념 스키마)의 변경이 있어도 외부 스키마에 영향을 주지 않는 성질이다.
    - 예시: 기존에는 학생 테이블에 이름, 학번만 있었는데, 전공 속성을 새로 추가했다고 하자. 그런데 사용자가 이름과 학번만 조회하는 프로그램을 쓰고 있다면, 전공이 추가되었더라도 기존 프로그램은 아무 영향 없이 동작해야 한다.

#### 데이터베이스의 3단계 구조

- 외부 스키마
  - 내 급여는 얼마인가? (A,B,C 필요)
  - 부서간의 평균 급여의 차이는? (B,C,D 필요)
  - 입사한지 10년이 넘은 사원 리스트는? (D,E,F 필요)
  - 각 사용자또는 응용프로그램이 바라보는 스키마
- 개념 스키마
  - 외부 스키마에서 필요한 모든 속성(A,B,C,D,E,F)
  - 모든 사용자의 관점을 통합한 스키마
  - DB에 저장되는 데이터와 그들 관계를 표현
- 내부 스키마
  - 개념 스키마를 실제로 저장하는 구조(A,B,C,D / E,F)
  - DB가 물리적으로 저장된 형식

## 데이터 모델링의 요소

- 데이터 모델링의 3가지 구성요소
  - Entity: 업무와 관련된 어떤 것
  - Attribute: 어떤 것이 갖는 성격
  - Relationship: 어떤 것 간의 관계

## 데이터 베이스 스키마

- 데이터 모델링의 대상
- 데이터 베이스 구조, 데이터 타입, 제약조건에 대한 명세
- 데이터 베이스 설계 단계에서 명시되며, 자주 변경되지않음
- Schema 예제

  - STUDENT

  | Name | Student_number | Class | Major |
  | ---- | -------------- | ----- | ----- |

  - COURSE

  | Course_name | Course_number | Credit_hours | Department |
  | ----------- | ------------- | ------------ | ---------- |

  - PREREQUISITE

  | Course_number | Prerequisite_number |
  | ------------- | ------------------- |

  - SECTION

  | Section_identifier | Course_number | Semester | Year | Instructor |
  | ------------------ | ------------- | -------- | ---- | ---------- |

  - GRADE_REPORT

  | Student_number | Section_identifier | Grade |
  | -------------- | ------------------ | ----- |

## 데이터 베이스 인스턴스

- 특정 시점에 데이터베이스에 실제로 저장되어 있는 데이터 값
- 예시

| Section_identifier | Course_number | Semester | Year | Instructor |
| ------------------ | ------------- | -------- | ---- | ---------- |
| 85                 | MATH2410      | Fall     | 04   | King       |
| 92                 | CS1310        | Fall     | 04   | Anderson   |
| 102                | CS3320        | Spring   | 05   | Knuth      |
| 112                | MATH2410      | Fall     | 05   | Chang      |
| 119                | CS1310        | Fall     | 05   | Anderson   |
| 135                | CS3380        | Fall     | 05   | Stone      |

## ERD 작성 순서

- 엔터티를 그린 후 적절하게 배치
  - 가급적 선이 꼬이지 않게 배치
  - 왼쪽 -> 오른쪽, 위-> 아래 순으로 읽어나가기 편하도록 배치
- 엔터티간 관계 설정
  - 식별자 관계를 우선 설정함
    - 식별자 관계: 부모로부터 상속받은 FK가 자식의 PK의 일부가 되는 관계
  - 가급적 Cycle 관계도 발생하지 않아야함
- 관계명 기술
  - 현재형 사용, 지나치게 포괄적인 단어는 지양
  - 실제 프로젝트에서는 크게 고려하지 않음
- 관계 차수(1:1, 1:N)와 필수성(필수 참여, 혹은 자율 참여) 표시
  - cardinality(대응수)
  - degree(차수)
  - 1:1, 1:N 을 이야기하며, Degree/Cardinality 두 가지 모두로 불린다

## 엔터티(Entity)

- 업무에 필요한 정보를 저장하고 관리하기 위한 집합적인 것(Thing)
- 엔터티와 인스턴스

  - 엔터티는 인스턴스의 집합

  | 엔터티 | 인스턴스                           |
  | ------ | ---------------------------------- |
  | 과목   | 데이터베이스 입문, 3학점, 전공필수 |
  |        | 데이터베이스 실무, 3학점, 전공선택 |
  | 강사   | 홍길동, 남, 정교수                 |
  |        | 강감찬, 여, 부교수                 |
  | 사건   | 12-345-00, 도난, 해결              |
  |        | 12-543-11, 실종, 미해결            |

### 엔터티의 특징

- 해당 업무에서 필요하고 관리하고자 하는 정보를 포함해야함
  - 관심 영역에 따라 달라짐
- 유일한 식별자에 의해 식별이 가능해야함(PK, 조건)
- 영속적으로 존재하는(둘 이상) 인스턴스의 집합이어야 함
  - 국민대학교 수강신청 시스템을 만들 경우
    - 학교(엔터티) - 국민 대학교(인스턴스)는 올바른 엔터티가 아니다
    - 하나 이상의 인스턴스가 있어야 엔터티가 될 수 있다
  - 성북구 대학관리 시스템
    - 학교(엔터티) - 고려대학교, 국민대학교, 상명대학교가 될 수 있어 올바른 엔터티이다
- 업무 프로세스에 의해 이용되어야 함

  - 업무 프로세스에 의해 CRUD가 발생해야함
  - CRUD가 발생하지 않는다면 부적절한 엔티티 도출, 업무 누락이다
  - ex) CRUD Matrix

  | Operation                          | Titles | Copies of Books | Check Out Requests | Reservation Requests | Branch Library Transfers | Borrowers | Librarians | Curators | Branch Libraries |
  | ---------------------------------- | ------ | --------------- | ------------------ | -------------------- | ------------------------ | --------- | ---------- | -------- | ---------------- |
  | Add Books to Library Database      | R, C   | C               |                    | U                    |                          |           |            | R        |                  |
  | Remove Books from Library Database | R      | R, D            | R, D               | R                    | R, D                     |           |            |          |                  |
  | Do Book Search                     | R      | R               | R                  | R                    | R                        | R         | R          | R        |                  |
  | Lend Books                         | R      | R               | R, C               | R,U                  | R                        | R         | R          |          |                  |
  | Return Books                       | R      | R               | R, U               | R,U                  |                          | R         | R          |          |                  |
  | Reserve Books                      | R      | R               | R                  | C                    |                          | R         | R          | R        |                  |
  | Cancel Book Reservations           | R      | R               |                    | U                    |                          | R         | R          | R        |                  |
  | Manage Book Transfers              | R      | R               | R                  | R                    | R, C, U                  |           |            | R        | R                |
  | DON'T CARE                         | U, D   | U               |                    | D                    |                          | C, U, D   | C, U, D    | C, U, D  | C,U,D            |

- 반드시 속성을 가져야한다
  - 속성 없이 엔터티의 이름만 존재할 수 없음
- 주식별자만 존재하고 일반속성은 없는 경우도 바람직 하지않음
  - 연관 엔터티는 주식별자 속성만 갖고 있어도 인정
- 엔터티의 명명
  - 엔터티 생성 의미대로, 실제 업무에서 사용하는 용어를 사용한다
  - 약어를 사용하지 않는다
  - 단수 명사를 사용한다
  - 이름이 동일한 엔터티가 중복으로 존재할 수 없다
- 다른 엔터티와 최소 한 개 이상의 관계를 가져야 함
  - 고립 엔터티: 부적절한 엔터티 도출, 또는 관계 누락
  - 하지만 통계성 엔터티/코드성 엔터티/시스템 처리용 내부 엔터티의 경우 고립 엔터티를 인정한다

### 엔터티의 분류

- 유형 엔터티
  - 물리적인 형태가 있고 안정적이며 지속적으로 활용됨
  - 교수, 강의실, 학생 등
- 개념 엔터티
  - 물리적인 형태는 존재하지 않으나 관리해야할 개념적 정보
  - 수업, 보험상품 등
- 사건(EVENT) 엔터티
  - 업무 수행 과정에서 발생하며 비교적 발생량이 많음(각종 통계 자료에 이용됨)
  - 수강신청, 주문, 입금 등

## 관계

- 엔터티간 논리적 연관성
- 페어링
  - 엔터티 내 인스턴스 간의 개별적 연관성
  - 페어링의 집합 -> 관계
  - 엔터티는 인스턴스의 집합을 논리적으로 표현한 것이다
- 관계의 분류
  - 존재에 의한 관계(부서, 사원) vs 행위에 의한 관계(고객, 주문)
- 관계의 표기법
  - 관계명
    - 각 관계는 두 방향의 관계명을 가짐
  - 명명 규칙
    - 애매한 동사를 피한다
    - 현재형으로 포함한다
      - ex) 부서(포함한다) - 사원(소속된다)
  - 관계 차수
    - 각 관계에 참여할 수 있는 인스턴스의 수
    - 1:N, 1:1, M:N등이 존재함
  - 학계에서의 대응수(Cardinality)에 해당하는 개념
    - 학계에서 차수(Degree)는 unary, binary, ternary, N-ary를 의미함
- 관계 선택성(Optionality)
  - 필수 참여(Mandatory Membership) 
  - 선택 참여(Optional Membership)
    - erd에서 o로 표기한다
    - 관계 양쪽이 Optional이라면, 해당 관계는 잘못 설정되었을 가능성이 크다
    
  ![img4](images/data_modeling4.png)
